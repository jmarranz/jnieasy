<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Direct memory manipulation</title><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title=""><link rel="up" href="index.html" title=""><link rel="prev" href="ar01s09.html" title="Java Code Generation"><link rel="next" href="ar01s11.html" title="Cross-platform options"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Direct memory manipulation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s09.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s11.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id529694"></a>Direct memory manipulation</h2></div></div></div><p>JNIEasy offers two interfaces (with two default implementation classes) to manipulate the native memory: NativeBuffer and NativeBufferIterator.</p><p>A NativeBuffer object represents a contiguous native memory section and has a native address, using this object the native memory can be read and modified directly without native objects. The buffer can own the native memory or be attached, if the buffer owns the memory this is freed automatically when the object goes out the scope (garbage collected), but can be explicitly freed with the method NativeBuffer.free(). A buffer can be created with the methods:</p><div class="orderedlist"><ol type="1"><li><p>NativeManager.allocateBuffer(long size) to create a buffer allocating memory.</p></li><li><p>NativeManager.attachBuffer(long address,long size) to attach the new buffer to an already allocated memory section. If the size is -1 the buffer is considered unlimited and the upper bound is not checked.</p></li></ol></div><p>The NativeBuffer interface has get and set methods to access native memory data, all of them use an offset parameter, this offset is the 0 based relative memory position in bytes where to read or write (to calculate the absolute position the offset is added to the buffer&#8217;s address). </p><p>Example:</p><p>NativeBuffer buffer = JNIEasy.get().getNativeManager().allocateBuffer(1024);</p><p>long offset = 16;</p><p>double value = buffer.getDouble(offset);</p><p>value = value*2;</p><p>buffer.setDouble(offset,value);</p><p>Every native instance holds a NativeBuffer (referenced by the NativeStateManager), the method NativeCapableUtil.getBuffer(Object) returns this object. Is not recommended to free the buffer of a native instance with NativeBuffer.free(), free the native memory of a native instance with NativeCapableUtil.free(Object).</p><p>The NativeBufferIterator interface is used to move along the buffer&#8217;s native memory. Every reading or writing moves forward the internal iterator position the read or written bytes. A buffer iterator is created with the method NativeBuffer.newBufferIterator(), the iterator created is &#8220;attached&#8221; to the parent buffer. Several iterators can read concurrently (mono or multithread) the same buffer with no problem, concurrent multithread is possible but obviously dangerous (NativeBuffer and NativeBufferIterator objects are not thread synchronized).</p><p>Example:</p><p>NativeBufferIterator it = buffer.newBufferIterator();</p><p>for(int i = 0; i &lt; 10; i++)</p><p>it.setInt(i);</p><p>writes 10 contiguous integers (jint) in the buffer.</p><p></p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s09.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s11.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Java Code Generation </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Cross-platform options</td></tr></table></div></body></html>
